---
- pipeline:
    name: manual-ci
    description: |
      A collection of CI jobs triggered manually via comment.
    success-message: Build succeeded (manual-ci pipeline).
    failure-message: |
      Build failed (manual-ci pipeline). To rerun just this ci comment
      "teim-ci: manual". To rerun other ci jobs comment "recheck".
      Note this ci does not currently run on "recheck".
    manager: independent
    require:
      opendev:
        open: true
        current-patchset: true
    reject:
      opendev:
        approval:
          - Workflow: -1
    trigger:
      opendev:
        - event: comment-added
          comment: (?i)^(Patch Set [0-9]+:)?( [\w\\+-]*)*(\n\n)?\s*teim-ci:\s*manual.*
    precedence: high
    start:
      opendev:
        Code-Review: 0
    success:
      opendev:
        Code-Review: 1
    failure:
      opendev:
        Code-Review: -1

- pipeline:
    name: automatic-ci
    description: |
      A collection of CI jobs.
    success-message: Build succeeded (automatic-ci pipeline).
    failure-message: |
      Build failed (automatic-ci pipeline). To rerun just this ci comment
      "teim-ci: auto". To rerun other ci jobs comment "recheck".
      Note this ci does run on "recheck".
    manager: independent
    require:
      opendev:
        open: true
        current-patchset: true
    reject:
      opendev:
        approval:
          - Workflow: -1
    trigger:
      opendev:
        - event: patchset-created
        - event: change-restored
        - event: comment-added
          comment: (?i)^(Patch Set [0-9]+:)?( [\w\\+-]*)*(\n\n)?\s*recheck.*
        - event: comment-added
          comment: (?i)^(Patch Set [0-9]+:)?( [\w\\+-]*)*(\n\n)?\s*teim-ci:\s*auto.*
    precedence: low
    start:
      opendev:
        Code-Review: 0
    success:
      opendev:
        Code-Review: 1
    failure:
      opendev:
        Code-Review: -1

- pipeline:
    name: nightly-ci
    description: |
      A collection of CI jobs run nightly.
    success-message: Build succeeded (nightly-ci pipeline).
    failure-message: |
      Build failed (nightly-ci pipeline).
    manager: independent
    trigger:
      timer:
        - time: '17 05 * * * * 60'
    precedence: low
    success:
      opendev:
        Code-Review: 1
    failure:
      opendev:
        Code-Review: -1

- pipeline:
    name: weekly-ci
    description: |
      A collection of CI jobs run weekly.
    success-message: Build succeeded (weekly-ci pipeline).
    failure-message: |
      Build failed (weekly-ci pipeline).
    manager: independent
    trigger:
      timer:
        - time: '0 8 * * 6'
    precedence: low
    success:
      opendev:
        Code-Review: 1
    failure:
      opendev:
        Code-Review: -1

- pipeline:
    name: check
    description: |
      Newly opened pull requests enter this pipeline to receive an
      initial verification
    manager: independent
    trigger:
      github:
        - event: pull_request
          action:
            - opened
            - changed
            - reopened
        - event: pull_request
          action: comment
          comment: (?i)^\s*recheck\s*$
    start:
      github:
        check: 'in_progress'
        comment: false
    success:
      github:
        check: 'success'
        comment: true
    failure:
      github:
        check: 'failure'
        comment: true
